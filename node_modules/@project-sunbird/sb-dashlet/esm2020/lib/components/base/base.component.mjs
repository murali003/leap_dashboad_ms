import { __decorate, __param } from "tslib";
import { EventEmitter, Inject } from '@angular/core';
import { of, Subject } from 'rxjs';
import { ReportState } from '../../types/index';
import { tap } from 'rxjs/operators';
import { constants } from '../../tokens/constants';
import * as jsonexport from "jsonexport/dist";
const jsonExport = jsonexport;
import { pick } from 'lodash-es';
import { DATA_SERVICE } from '../../tokens/index';
let BaseComponent = class BaseComponent {
    constructor(dataService) {
        this.dataService = dataService;
        this.data = [];
        this._isInitialized = false;
        this.state = new EventEmitter();
        this.events = new EventEmitter();
        this.eventsSubject = new Subject();
    }
    fetchData(config) {
        const { values = null, location: { url = null, options = {}, method = 'GET' } = {} } = config || {};
        if (values)
            return of(values);
        if (!url)
            throw new Error('invalid input');
        this.state.emit(ReportState.PENDING);
        return this.dataService.fetchData({ method, url, options }).pipe(tap(_ => this.state.emit(ReportState.DONE)));
    }
    getConfigValue(key) {
        return this.config && this.config[key];
    }
    checkIfInitialized() {
        if (!this._isInitialized) {
            throw Error(constants.CHART_NOT_INITIALIZED);
        }
    }
    _downloadFile(url, filename) {
        var link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", filename);
        link.click();
    }
    getCsv(data, options) {
        return new Promise((resolve, reject) => {
            jsonExport(data, options, (error, csv) => {
                if (!error && csv) {
                    resolve(csv);
                }
                else {
                    reject(error);
                }
            });
        });
    }
    async exportAsCsv(data, options) {
        const { columnsToPick = [], ...others } = options || {};
        const JSON = this.sortAndTransformData(data || this.data, { columnsToPick });
        try {
            const csv = await this.getCsv(JSON, others);
            var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            var url = URL.createObjectURL(blob);
            this._downloadFile(url, 'data.csv');
        }
        catch (error) {
            console.log(error);
        }
    }
    sortAndTransformData(rows, { columnsToPick = [] }) {
        if (!columnsToPick.length)
            return rows;
        return rows.map(row => {
            const defaultValue = columnsToPick.reduce((acc, val) => {
                acc[val] = undefined;
                return acc;
            }, {});
            return pick({ ...defaultValue, ...row }, columnsToPick);
        });
    }
};
BaseComponent = __decorate([
    __param(0, Inject(DATA_SERVICE))
], BaseComponent);
export { BaseComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zYi1kYXNobGV0cy9zcmMvbGliL2NvbXBvbmVudHMvYmFzZS9iYXNlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQWUsTUFBTSxlQUFlLENBQUM7QUFDbEUsT0FBTyxFQUFjLEVBQUUsRUFBQyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDOUMsT0FBTyxFQUE2QixXQUFXLEVBQTZELE1BQU0sbUJBQW1CLENBQUM7QUFDdEksT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNuRCxPQUFPLEtBQUssVUFBVSxNQUFNLGlCQUFpQixDQUFDO0FBQUMsTUFBTSxVQUFVLEdBQUcsVUFBVSxDQUFDO0FBQzdFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDakMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRWxELElBQXNCLGFBQWEsR0FBbkMsTUFBc0IsYUFBYTtJQUVqQyxZQUE0QyxXQUF5QjtRQUF6QixnQkFBVyxHQUFYLFdBQVcsQ0FBYztRQUtyRSxTQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ0EsbUJBQWMsR0FBWSxLQUFLLENBQUM7UUFFMUMsVUFBSyxHQUFHLElBQUksWUFBWSxFQUFlLENBQUM7UUFDeEMsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFlLENBQUM7UUFDekMsa0JBQWEsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztJQVZzQixDQUFDO0lBeUIxRSxTQUFTLENBQUMsTUFBYTtRQUNyQixNQUFNLEVBQUUsTUFBTSxHQUFHLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxHQUFHLEdBQUcsSUFBSSxF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LG9CQUFvQixDQUFDLElBQWMsRUFBRSxFQUFFLGFBQWEsR0FBRyxFQUFFLEVBQStCO1FBQ3RGLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTTtZQUFFLE9BQU8sSUFBSSxDQUFDO1FBQ3ZDLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNwQixNQUFNLFlBQVksR0FBRyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFO2dCQUNyRCxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsU0FBUyxDQUFDO2dCQUNyQixPQUFPLEdBQUcsQ0FBQztZQUNiLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNQLE9BQU8sSUFBSSxDQUFDLEVBQUUsR0FBRyxZQUFZLEVBQUUsR0FBRyxHQUFHLEVBQUUsRUFBRSxhQUFhLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FHRixDQUFBO0FBM0ZxQixhQUFhO0lBRXBCLFdBQUEsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFBO0dBRmIsYUFBYSxDQTJGbEM7U0EzRnFCLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIsIEluamVjdCwgVGVtcGxhdGVSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IElucHV0UGFyYW1zLCBJQmFzZSwgSURhdGEsIFJlcG9ydFN0YXRlLCBJUmVwb3J0VHlwZSwgVXBkYXRlSW5wdXRQYXJhbXMsIEN1c3RvbUV2ZW50LCBJRGF0YVNlcnZpY2UgfSBmcm9tICcuLi8uLi90eXBlcy9pbmRleCc7XG5pbXBvcnQgeyB0YXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBjb25zdGFudHMgfSBmcm9tICcuLi8uLi90b2tlbnMvY29uc3RhbnRzJztcbmltcG9ydCAqIGFzIGpzb25leHBvcnQgZnJvbSBcImpzb25leHBvcnQvZGlzdFwiOyBjb25zdCBqc29uRXhwb3J0ID0ganNvbmV4cG9ydDtcbmltcG9ydCB7IHBpY2sgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgREFUQV9TRVJWSUNFIH0gZnJvbSAnLi4vLi4vdG9rZW5zL2luZGV4JztcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBQYXJ0aWFsPElCYXNlPiB7XG5cbiAgY29uc3RydWN0b3IoQEluamVjdChEQVRBX1NFUlZJQ0UpIHByb3RlY3RlZCBkYXRhU2VydmljZTogSURhdGFTZXJ2aWNlKSB7IH1cblxuICBpZDogc3RyaW5nO1xuICB0ZW1wbGF0ZVJlZnM6IFJlY29yZDxzdHJpbmcsIFRlbXBsYXRlUmVmPGFueT4+O1xuICAkY29udGV4dDtcbiAgZGF0YSA9IFtdO1xuICBwcm90ZWN0ZWQgX2lzSW5pdGlhbGl6ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBzdGF0ZSA9IG5ldyBFdmVudEVtaXR0ZXI8UmVwb3J0U3RhdGU+KCk7XG4gIGV2ZW50cyA9IG5ldyBFdmVudEVtaXR0ZXI8Q3VzdG9tRXZlbnQ+KCk7XG4gIGV2ZW50c1N1YmplY3Q6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG4gIGFic3RyYWN0IGlucHV0UGFyYW1ldGVycztcbiAgYWJzdHJhY3QgcmVwb3J0VHlwZTogSVJlcG9ydFR5cGU7XG4gIGFic3RyYWN0IGNvbmZpZzogb2JqZWN0O1xuICBhYnN0cmFjdCBfZGVmYXVsdENvbmZpZzogb2JqZWN0O1xuICBhYnN0cmFjdCBleHBvcnRPcHRpb25zOiBzdHJpbmdbXTtcbiAgYWJzdHJhY3QgaW5pdGlhbGl6ZShjb25maWc6IElucHV0UGFyYW1zKTogUHJvbWlzZTxhbnk+XG4gIGFic3RyYWN0IGJ1aWxkZXIoY29uZmlnLCBkYXRhKTogdm9pZDtcbiAgYWJzdHJhY3QgcmVzZXQoKTogdm9pZDtcbiAgYWJzdHJhY3QgZGVzdHJveSgpOiB2b2lkO1xuICBhYnN0cmFjdCB1cGRhdGUoY29uZmlnOiBVcGRhdGVJbnB1dFBhcmFtcyk7XG4gIGFic3RyYWN0IGFkZERhdGEoZGF0YTogb2JqZWN0KTtcbiAgYWJzdHJhY3QgZXhwb3J0QXMoZm9ybWF0OiBzdHJpbmcpO1xuXG4gIGZldGNoRGF0YShjb25maWc6IElEYXRhKTogT2JzZXJ2YWJsZTxhbnlbXT4ge1xuICAgIGNvbnN0IHsgdmFsdWVzID0gbnVsbCwgbG9jYXRpb246IHsgdXJsID0gbnVsbCwgb3B0aW9ucyA9IHt9LCBtZXRob2QgPSAnR0VUJyB9ID0ge30gfSA9IGNvbmZpZyB8fCB7fTtcbiAgICBpZiAodmFsdWVzKSByZXR1cm4gb2YodmFsdWVzKTtcbiAgICBpZiAoIXVybCkgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIGlucHV0Jyk7XG4gICAgdGhpcy5zdGF0ZS5lbWl0KFJlcG9ydFN0YXRlLlBFTkRJTkcpO1xuICAgIHJldHVybiB0aGlzLmRhdGFTZXJ2aWNlLmZldGNoRGF0YSh7IG1ldGhvZCwgdXJsLCBvcHRpb25zIH0pLnBpcGUoXG4gICAgICB0YXAoXyA9PiB0aGlzLnN0YXRlLmVtaXQoUmVwb3J0U3RhdGUuRE9ORSkpXG4gICAgKTtcbiAgfVxuXG4gIGdldENvbmZpZ1ZhbHVlKGtleTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnICYmIHRoaXMuY29uZmlnW2tleV07XG4gIH1cblxuICBwcm90ZWN0ZWQgY2hlY2tJZkluaXRpYWxpemVkKCk6IG5ldmVyIHwgdm9pZCB7XG4gICAgaWYgKCF0aGlzLl9pc0luaXRpYWxpemVkKSB7XG4gICAgICB0aHJvdyBFcnJvcihjb25zdGFudHMuQ0hBUlRfTk9UX0lOSVRJQUxJWkVEKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2Rvd25sb2FkRmlsZSh1cmwsIGZpbGVuYW1lKSB7XG4gICAgdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcbiAgICBsaW5rLnNldEF0dHJpYnV0ZShcImhyZWZcIiwgdXJsKTtcbiAgICBsaW5rLnNldEF0dHJpYnV0ZShcImRvd25sb2FkXCIsIGZpbGVuYW1lKTtcbiAgICBsaW5rLmNsaWNrKCk7XG4gIH1cblxuICBnZXRDc3YoZGF0YSwgb3B0aW9ucykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBqc29uRXhwb3J0KGRhdGEsIG9wdGlvbnMsIChlcnJvciwgY3N2KSA9PiB7XG4gICAgICAgIGlmICghZXJyb3IgJiYgY3N2KSB7XG4gICAgICAgICAgcmVzb2x2ZShjc3YpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuXG4gIGFzeW5jIGV4cG9ydEFzQ3N2KGRhdGE/OiBvYmplY3RbXSwgb3B0aW9ucz86IFJlY29yZDxzdHJpbmcsIGFueT4pIHtcbiAgICBjb25zdCB7IGNvbHVtbnNUb1BpY2sgPSBbXSwgLi4ub3RoZXJzIH0gPSBvcHRpb25zIHx8IHt9O1xuICAgIGNvbnN0IEpTT04gPSB0aGlzLnNvcnRBbmRUcmFuc2Zvcm1EYXRhKGRhdGEgfHwgdGhpcy5kYXRhLCB7IGNvbHVtbnNUb1BpY2sgfSk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNzdjogYW55ID0gYXdhaXQgdGhpcy5nZXRDc3YoSlNPTiwgb3RoZXJzKTtcbiAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW2Nzdl0sIHsgdHlwZTogJ3RleHQvY3N2O2NoYXJzZXQ9dXRmLTg7JyB9KTtcbiAgICAgIHZhciB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgdGhpcy5fZG93bmxvYWRGaWxlKHVybCwgJ2RhdGEuY3N2Jyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBzb3J0QW5kVHJhbnNmb3JtRGF0YShyb3dzOiBvYmplY3RbXSwgeyBjb2x1bW5zVG9QaWNrID0gW10gfTogeyBjb2x1bW5zVG9QaWNrOiBzdHJpbmdbXSB9KSB7XG4gICAgaWYgKCFjb2x1bW5zVG9QaWNrLmxlbmd0aCkgcmV0dXJuIHJvd3M7XG4gICAgcmV0dXJuIHJvd3MubWFwKHJvdyA9PiB7XG4gICAgICBjb25zdCBkZWZhdWx0VmFsdWUgPSBjb2x1bW5zVG9QaWNrLnJlZHVjZSgoYWNjLCB2YWwpID0+IHtcbiAgICAgICAgYWNjW3ZhbF0gPSB1bmRlZmluZWQ7XG4gICAgICAgIHJldHVybiBhY2M7XG4gICAgICB9LCB7fSk7XG4gICAgICByZXR1cm4gcGljayh7IC4uLmRlZmF1bHRWYWx1ZSwgLi4ucm93IH0sIGNvbHVtbnNUb1BpY2spO1xuICAgIH0pO1xuICB9XG5cblxufVxuIl19